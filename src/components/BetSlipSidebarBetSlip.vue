<script setup>
import useBetslipStore from "@/stores/useBetslipStore";
import PrimaryButton from "@/components/Buttons/PrimaryButton.vue";
import BetSlipSidebarBetSlipItem from "@/components/BetSlipSidebarBetSlipItem.vue";
import PrimaryTab from "@/components/Tabs/PrimaryTab.vue";
import { computed, ref } from "vue";
import { useRoute, useRouter } from "vue-router";
import { Menu, MenuButton, MenuItem, MenuItems } from "@headlessui/vue";
import reduce from "lodash/reduce";
import useAsync from "@/composables/useAsync";
import Async from "@/components/Async.vue";

const store = useBetslipStore();
const route = useRoute();
const router = useRouter();

const { call, loading, error } = useAsync(store.postBets);

const items = computed(() => {
	return [
		{
			icon: "fa-solid fa-ticket",
			title: "Single",
			active: true,
			action: () => {},
		},
		{
			icon: "fa-solid fa-tickets",
			title: "Multi",
			active: route.path.endsWith("/sports/home"),
			to: "/sports/home",
		},
	];
});

const totalStake = computed(() => {
	return reduce(
		store.betslip,
		(acc, bet) => {
			return acc + bet.amount;
		},
		0
	).toFixed(2);
});
const estPayout = computed(() => {
	return reduce(
		store.betslip,
		(acc, bet) => {
			return acc + bet.amount * bet.odds;
		},
		0
	).toFixed(2);
});
</script>
<template>
	<div
		class="absolute top-0 left-0 right-0 bottom-0 flex flex-col justify-between h-full"
	>
		<div class="grid grid-cols-2 gap-x-4 px-4 bg-brand-sidebarBg py-[20px]">
			<PrimaryTab
				v-for="item in items"
				:key="item.title"
				:item="item"
				:inline="true"
				color="primary"
				background="#071420"
			>
				<h4
					class="text-center flex font-display font-semibold items-center uppercase group-hover:text-white transition ease-in duration-100"
				>
					<i class="mx-auto mr-3" :class="item.icon" />
					<p>{{ item.title }}</p>
				</h4>
			</PrimaryTab>
		</div>

		<div class="px-4 flex-1 bg-brand-sidebarBg overflow-scroll">
			<transition-group name="list" tag="div">
				<BetSlipSidebarBetSlipItem
					v-for="(bet, key) in store.betslip"
					:key="key"
					:bet="bet"
				/>
			</transition-group>
		</div>
		<div
			class="dark-gradient-bg _betslipsidebar-betslip-bottom p-[16px] text-brand-grey"
		>
			<div class="flex justify-between">
				<p class="font-medium">Total Stake</p>
				<p class="tracking-wider font-semibold">${{ totalStake }}</p>
			</div>
			<div class="flex justify-between">
				<p class="font-medium">Est. Payout</p>
				<p class="text-brand-lightGrey tracking-wider font-semibold">
					${{ estPayout }}
				</p>
			</div>
			<Async :loading="loading" :error="error">
				<PrimaryButton @click="call" class="mt-[15px] !w-full relative">
					Place Bets
					<svg
						xmlns="http://www.w3.org/2000/svg"
						width="20"
						height="23"
						viewBox="0 0 20 23"
						fill="none"
						class="absolute right-3"
					>
						<g clip-path="url(#clip0_895_6974)">
							<path
								d="M19.9277 11.3128C19.7886 10.6074 19.3941 10.105 18.7733 9.77892C18.3982 9.58261 17.9973 9.47281 17.5834 9.40626C17.0823 9.32308 16.5746 9.29646 16.067 9.29978C15.6531 9.29978 15.236 9.29978 14.8221 9.29978C14.8059 9.29978 14.793 9.29646 14.7768 9.29646C14.7801 9.29646 14.7865 9.2898 14.7898 9.2898C15.5464 8.81732 16.2642 8.2916 16.9206 7.67938C17.4024 7.23351 17.8486 6.75105 18.1945 6.18541C18.4079 5.83271 18.5761 5.46338 18.6408 5.04746C18.6634 4.90106 18.6699 4.75798 18.6634 4.61491C18.6893 4.17238 18.5696 3.76311 18.3045 3.39378C18.0199 2.99783 17.6481 2.70502 17.2278 2.47877C17.0467 2.37895 16.843 2.349 16.6393 2.33569C16.4065 2.31906 16.1737 2.31573 15.9441 2.29244C15.4526 2.24253 15.0452 2.02958 14.7477 1.61366C14.5537 1.34082 14.3662 1.06133 14.1689 0.788485C13.9911 0.542263 13.7842 0.325987 13.519 0.176258C13.3541 0.0864198 13.1795 0.0331826 12.9952 0.00989133C12.9823 0.00989133 12.9726 0.00323668 12.9629 -0.00341797H12.6492C12.549 0.016546 12.4488 0.0298553 12.3485 0.0531466C11.7665 0.199549 11.2944 0.525627 10.9097 0.991452C10.3762 1.63363 10.0625 2.38227 9.86851 3.19081C9.74564 3.70322 9.67127 4.22229 9.61307 4.74468C9.57103 5.14395 9.52577 5.53991 9.47403 5.93919C9.41906 6.37174 9.34793 6.80429 9.18626 7.21355C9.17656 7.23684 9.16686 7.26013 9.15069 7.29341C9.12806 7.20024 9.11189 7.12039 9.09249 7.0372C8.92759 6.36508 8.66245 5.73289 8.34234 5.12399C8.0772 4.62489 7.77649 4.15241 7.42082 3.7132C7.00694 3.2008 6.54456 2.74495 5.96255 2.43218C5.5907 2.23254 5.193 2.12274 4.76942 2.15269C4.44608 2.17598 4.1486 2.28578 3.87376 2.46213C3.48252 2.71168 3.16888 3.03776 2.97811 3.47696C2.85847 3.75646 2.7938 4.04926 2.74207 4.3454C2.68063 4.69144 2.63213 5.04413 2.52543 5.38019C2.34759 5.94917 2.00162 6.37506 1.50044 6.6712C1.30643 6.78433 1.1189 6.90411 0.931359 7.02722C0.540117 7.28675 0.300844 7.66939 0.13594 8.1086C0.0357044 8.37479 -0.00309651 8.65096 0.00983714 8.93378C0.00660373 9.02362 0.00337031 9.11345 0.00983714 9.20662C0.0389378 9.56597 0.155341 9.89537 0.339645 10.2015C0.624185 10.674 1.01219 11.0433 1.45841 11.3494C2.16976 11.8385 2.95224 12.1513 3.79616 12.2977C3.97723 12.3276 4.1583 12.3509 4.33938 12.3609C3.98047 12.5206 3.64419 12.7203 3.31762 12.9465C2.73884 13.3525 2.22149 13.8283 1.77528 14.3839C1.43254 14.8132 1.14153 15.2757 0.957227 15.8014C0.844057 16.1208 0.782623 16.4535 0.795556 16.7929C0.789089 16.8861 0.789089 16.9792 0.795556 17.0757C0.82789 17.5649 1.01866 17.9841 1.342 18.3368C1.55864 18.573 1.80438 18.776 2.10185 18.8991C2.30879 18.9856 2.52866 19.0189 2.75177 19.0355C2.96518 19.0522 3.17858 19.0588 3.39199 19.0888C3.56659 19.1154 3.73796 19.1686 3.90933 19.2152C3.93197 19.2219 3.9546 19.2518 3.9643 19.2751C4.0419 19.5014 4.12274 19.7309 4.19387 19.9572C4.34261 20.423 4.63038 20.7757 5.01192 21.0585C5.31263 21.2782 5.63274 21.4512 5.99811 21.521C6.40552 21.5976 6.79353 21.5344 7.16861 21.358C7.58895 21.1584 7.93169 20.8589 8.23563 20.5062C8.92759 19.7043 9.38673 18.7627 9.73917 17.7645C9.80384 17.5815 9.95581 17.1523 10.1239 16.6598C10.7448 19.2618 12.0737 22.283 14.405 22.9385C13.477 22.679 11.3397 18.5231 11.178 15.4287C11.3591 15.8713 11.5854 16.2938 11.8571 16.6931C12.1772 17.1656 12.549 17.5948 12.9726 17.9708C13.4479 18.39 13.9652 18.7361 14.5602 18.9424C15.1066 19.132 15.6563 19.1786 16.2125 18.9923C16.5972 18.8625 16.9206 18.6363 17.1987 18.3335C17.5188 17.9874 17.7548 17.5915 17.9359 17.1523C18.0264 16.9327 18.049 16.6998 18.0361 16.4635C18.0426 16.3604 18.0426 16.2605 18.0329 16.1574C18.0135 15.9478 17.9876 15.7382 17.965 15.5285C17.965 15.5019 17.965 15.4786 17.965 15.452C17.9941 15.1891 18.1008 14.9463 18.2592 14.72C18.4564 14.4372 18.6925 14.1943 18.9318 13.9514C19.184 13.6952 19.4459 13.4423 19.6496 13.1362C19.8371 12.8567 19.9568 12.5539 19.9859 12.2145C19.9859 12.2045 19.9923 12.1946 19.9956 12.1846V11.6589C19.9762 11.5391 19.96 11.416 19.9374 11.2962L19.9277 11.3128ZM16.7201 12.0781C16.7201 12.0781 16.7136 12.0914 16.7136 12.0981C16.6942 12.3276 16.6134 12.5306 16.4873 12.7169C16.3515 12.9232 16.1769 13.0929 16.0055 13.266C15.8439 13.429 15.6854 13.592 15.5528 13.7817C15.4073 13.988 15.3265 14.2109 15.3556 14.4704C15.3718 14.6102 15.3879 14.7533 15.4009 14.893C15.417 15.0727 15.4041 15.2524 15.3362 15.4187C15.2166 15.7115 15.0549 15.9811 14.8415 16.214C14.654 16.4169 14.4373 16.57 14.1786 16.6565C13.8036 16.7829 13.4317 16.7497 13.0664 16.6232C12.6654 16.4835 12.3162 16.2506 11.9961 15.9677C11.7116 15.7149 11.4626 15.4254 11.2459 15.1093C10.9582 14.6867 10.7351 14.2309 10.609 13.7285C10.596 13.6719 10.5799 13.6153 10.5637 13.5454C10.5572 13.5654 10.554 13.5721 10.554 13.5821C10.5443 13.775 9.94288 15.4786 9.82001 15.828C9.58397 16.5001 9.27356 17.1356 8.80795 17.6747C8.60424 17.9109 8.37144 18.1139 8.09013 18.247C7.83793 18.3667 7.57602 18.4067 7.30118 18.3568C7.05544 18.3102 6.8388 18.1937 6.63833 18.044C6.37966 17.8543 6.18889 17.6148 6.08865 17.302C6.04015 17.1489 5.98518 16.9959 5.93345 16.8428C5.92698 16.8262 5.91081 16.8062 5.89788 16.8029C5.78148 16.773 5.66831 16.7364 5.54867 16.7164C5.4064 16.6964 5.2609 16.6898 5.11863 16.6798C4.96989 16.6698 4.82115 16.6465 4.68212 16.5866C4.48165 16.5034 4.31674 16.367 4.17124 16.2073C3.95137 15.9711 3.82203 15.6882 3.80263 15.3588C3.78646 15.1126 3.83173 14.8764 3.91256 14.6468C4.03867 14.2941 4.23267 13.9813 4.46224 13.6919C4.76295 13.3159 5.11216 12.9964 5.50017 12.7236C5.81058 12.504 6.14039 12.3243 6.50253 12.2045C6.51546 12.2012 6.52516 12.1946 6.53809 12.1912C6.52516 12.1846 6.51546 12.1846 6.50253 12.1846C6.27295 12.2012 6.04662 12.1779 5.82028 12.1413C5.2512 12.0448 4.72415 11.8352 4.24561 11.5025C3.9449 11.2962 3.68299 11.0466 3.49222 10.7305C3.36935 10.5242 3.28852 10.3046 3.27235 10.0617C3.25618 9.85877 3.28528 9.65913 3.35642 9.46948C3.46635 9.17334 3.62802 8.91714 3.88993 8.74412C4.01603 8.66094 4.14214 8.58108 4.27147 8.50455C4.61098 8.30491 4.84055 8.01876 4.96342 7.63612C5.03456 7.40986 5.07013 7.17362 5.10893 6.94071C5.14449 6.74107 5.18653 6.54143 5.26736 6.3551C5.39347 6.05897 5.60687 5.84269 5.86878 5.673C6.05308 5.55322 6.25355 5.48001 6.47343 5.4667C6.75797 5.44674 7.02311 5.51994 7.27531 5.65304C7.66655 5.86266 7.97696 6.16877 8.25827 6.51481C8.49754 6.80762 8.70125 7.12704 8.87908 7.4631C9.09572 7.87236 9.27356 8.29826 9.3835 8.75077C9.39643 8.80401 9.40936 8.86058 9.4223 8.9238C9.432 8.9005 9.4417 8.88387 9.44816 8.87056C9.5581 8.59439 9.60337 8.30491 9.64217 8.01211C9.67774 7.74592 9.70684 7.47641 9.73594 7.2069C9.77474 6.8542 9.82647 6.50483 9.90731 6.16212C10.0366 5.61643 10.2501 5.11401 10.609 4.68146C10.8709 4.36869 11.1845 4.14576 11.579 4.04926C11.6469 4.03263 11.7148 4.02265 11.7827 4.00934H11.9961C11.9961 4.00934 12.0123 4.01599 12.0187 4.01599C12.1448 4.0293 12.2612 4.0659 12.3712 4.12912C12.549 4.22894 12.688 4.37534 12.8077 4.54171C12.9402 4.72471 13.0664 4.91104 13.1957 5.09737C13.3962 5.37687 13.671 5.51994 14.0008 5.55322C14.156 5.56985 14.3144 5.57318 14.4697 5.58316C14.6055 5.59314 14.7445 5.61311 14.8674 5.67965C15.1519 5.83271 15.4009 6.02902 15.5916 6.29521C15.7986 6.58469 15.8762 6.90744 15.818 7.26346C15.7727 7.54296 15.6595 7.7925 15.5173 8.02874C15.2845 8.41139 14.9838 8.73414 14.6604 9.0336C14.2174 9.44286 13.7324 9.79888 13.2248 10.1183C13.1537 10.1616 13.0825 10.2048 13.0146 10.2514C13.0922 10.2647 13.1698 10.2714 13.2474 10.2747C13.5255 10.2747 13.8068 10.2747 14.0849 10.2747C14.4276 10.2747 14.7671 10.2913 15.1066 10.3479C15.3847 10.3945 15.6563 10.4677 15.9085 10.6008C16.3256 10.8204 16.5908 11.1564 16.6845 11.6322C16.7007 11.7121 16.7104 11.7953 16.7233 11.8751V12.0848L16.7201 12.0781Z"
								fill="white"
								fill-opacity="0.4"
							/>
						</g>
						<defs>
							<clipPath id="clip0_895_6974">
								<rect width="20" height="23" fill="white" />
							</clipPath>
						</defs>
					</svg>
				</PrimaryButton>
			</Async>
		</div>
	</div>
</template>
<style scoped>
.list-enter-active,
.list-leave-active {
	transition: transform 0.2s ease-out;
}
.list-enter-from,
.list-leave-to {
	transform: translateX(100%);
}
.list-enter-to,
.list-leave-from {
	transform: translateX(0);
}
._betslip-badge {
	display: flex;
	padding: 4px;
	justify-content: center;
	align-items: center;
	border-radius: 75px;
	height: 22px;
	width: 22px;
	background: linear-gradient(180deg, #68d763 0%, #3aaa35 100%);
}
</style>
